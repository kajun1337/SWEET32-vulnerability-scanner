#!/bin/bash

RESTORE='\033[0m'
BLACK='\033[00;30m'
RED='\033[00;31m'
GREEN='\033[00;32m'
YELLOW='\033[00;33m'
BLUE='\033[00;34m'
PURPLE='\033[00;35m'
CYAN='\033[00;36m'
LIGHTGRAY='\033[00;37m'
LBLACK='\033[01;30m'
LRED='\033[01;31m'
LGREEN='\033[01;32m'
LYELLOW='\033[01;33m'
LBLUE='\033[01;34m'
LPURPLE='\033[01;35m'
LCYAN='\033[01;36m'
WHITE='\033[01;37m'
OVERWRITE='\e[1A\e[K'


function _task {

    if [[ $TASK != "" ]]; then
        printf "${OVERWRITE}${LGREEN} [✓]  ${LGREEN}${TASK}\n"
    fi

    TASK=$1
    printf "${LBLACK} [ ]  ${TASK} \n${LRED}"
}
function _cmd {

    if ! output=$(eval "$1" 2>&1); then

        printf "${OVERWRITE}${LRED} [X]  ${TASK}${LRED}\n"
        printf "      ${output}\n\n"
        exit 1
    fi
    return 0
}
clear

printf "${YELLOW}
██╗  ██╗ █████╗      ██╗██╗   ██╗███╗   ██╗ ██╗██████╗ ██████╗ ███████╗
██║ ██╔╝██╔══██╗     ██║██║   ██║████╗  ██║███║╚════██╗╚════██╗╚════██║
█████╔╝ ███████║     ██║██║   ██║██╔██╗ ██║╚██║ █████╔╝ █████╔╝    ██╔╝
██╔═██╗ ██╔══██║██   ██║██║   ██║██║╚██╗██║ ██║ ╚═══██╗ ╚═══██╗   ██╔╝ 
██║  ██╗██║  ██║╚█████╔╝╚██████╔╝██║ ╚████║ ██║██████╔╝██████╔╝   ██║  
╚═╝  ╚═╝╚═╝  ╚═╝ ╚════╝  ╚═════╝ ╚═╝  ╚═══╝ ╚═╝╚═════╝ ╚═════╝    ╚═╝                                                                    
 ${LBLACK}SWEET32 Information System ${YELLOW}SWEET32 checker v0.1 ${LBLACK}https://github.com/kajun1337
 
"

if [[ $(id -u) -ne 0 ]] ; then printf "\n${LRED} Please run as root${RESTORE}\n\n" ; exit 1 ; fi

_task "update dependencies"
   _cmd  'apt-get install nmap -y'

_task "update system"
   _cmd  'apt-get update -y'

printf "${OVERWRITE}${LGREEN} [✓]  ${LGREEN}${TASK}${RESTORE}\n"

read -p $'\e[34mPlease enter the port number: \e[0m' port

printf "%-20s | %-20s | %-20s\n" "IP Adress" "Port Status" "Scan Result"
printf "%s\n" "-----------------------------------------------------------------"

cat ip-list.txt | while read ip; do

    port_status=$(nmap -T5 -p $port $ip | grep "^$port" | awk '{print $2}')

    if [ "$port_status" == "closed" ] || [ "$port_status" == "filtered" ]; then

        printf "\033[0;33m%-20s | %-20s | %-20s\033[0m\n" "$ip" "$port_status" "Filtered or Closed"
    else

        result=$(nmap -T5 -sV --script ssl-enum-ciphers -p $port $ip | grep "64-bit block cipher 3DES vulnerable to SWEET32 attack")

        if [ -z "$result" ]; then

            printf "\033[0;32m%-20s | %-20s | %-20s\033[0m\n" "$ip" "open" "No vulnerabilities"
        else

            printf "\033[0;31m%-20s | %-20s | %-20s\033[0m\n" "$ip" "open" "Vulnerable to SWEET32 attack"
        fi
    fi
done